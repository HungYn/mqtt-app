# Computer Usage Timer & Remote Control System

這是一個基於 Python 開發的電腦使用時間管理系統。它能根據預設的時段自動鎖定或關閉電腦，並支援透過 **MQTT 協定** 進行遠端即時監控、指令操作與時段修改。

## 🌟 主要功能

* **自動化時間管理**：根據設定檔自動判斷當前是否為允許使用時段。
* **靈活執行動作**：支援「鎖定螢幕 (Lock)」或「強制關機 (Shutdown)」兩種模式。
* **MQTT 遠端控制**：
    * **即時指令**：可遠端發送指令立即鎖定、關機。
    * **動態更新**：可透過 MQTT 遠端修改 Action 模式或 AllowedTimes 允許時段，並即時寫入設定檔。
    * **狀態查詢**：遠端查詢目前電腦的運作模式與時段設定。
* **高可靠性**：具備 MQTT 自動重連機制，並透過 Windows 工作排程器確保開機自動啟動。
* **隱身執行**：程式啟動後自動隱藏控制台視窗，不干擾使用者操作。

## 📂 檔案結構

* `limit_time.py`: 核心邏輯腳本，負責時間檢查與 MQTT 通訊。
* `limit_time.ini`: 系統設定檔，儲存 MQTT 資訊、動作模式與時段（需手動建立）。
* `limit_time.xml`: Windows 工作排程器匯入檔，設定開機 30 秒後以最高權限執行。
* `limit_time.log`: 自動產生的日誌檔，記錄系統執行狀態與 MQTT 訊息。

## 🚀 快速開始

### 1. 環境配置
本程式依賴 `paho-mqtt` 函式庫，請先執行安裝：
```bash
pip install paho-mqtt

### 2. 建立設定檔 `limit_time.ini`

程式啟動時會讀取同目錄下的 `limit_time.ini` 檔案。請依照以下格式建立，這將決定你的控制邏輯與時間限制：

```ini
[MQTT]
; MQTT 伺服器位址與通訊埠
broker = 192.168.1.100
port = 1883
; 接收指令的主題（例如：手機發送指令到此）
subscribe_topic = computer/command
; 回傳狀態的主題（例如：電腦在此回報執行結果）
publish_topic = computer/status

[Action]
; 當不在允許時段時執行的動作：lock (鎖定) 或 shutdown (關機)
action = lock

[AllowedTimes]
; 設定各星期的允許使用時段，多段時間請用逗號隔開
; 支援格式：monday, mon, 星期一, 週一
monday = 08:00-12:00, 13:30-21:00
tuesday = 08:00-21:00
星期六 = 10:00-22:00
星期日 = 14:00-18:00

[Defaults]
; 當收到 "reset" 指令時，系統會還原至此處的設定值
action = lock
星期一 = 08:00-22:00
星期二 = 08:00-22:00
星期三 = 08:00-22:00
星期四 = 08:00-22:00
星期五 = 08:00-22:00
星期六 = 10:00-17:00
星期日 = 14:00-18:00

### 3. 編譯為執行檔 (建議)

為了確保程式能在背景穩定執行，且不被使用者輕易看見原始碼或關閉控制台視窗，建議使用 `PyInstaller` 將腳本打包成單一的 `.exe` 執行檔。

#### 安裝打包工具
在終端機執行以下指令安裝 PyInstaller：
```bash
pip install pyinstaller

### 4. 部署自動啟動 (Windows 工作排程器)

為了讓系統在開機時自動啟動，並確保具備執行「關機」或「鎖定」指令所需的最高權限，請依照以下步驟匯入預設的 XML 設定檔。

#### 匯入步驟：
1.  **開啟工具**：在 Windows 搜尋列輸入「工作排程器」(Task Scheduler) 並開啟。
2.  **匯入任務**：在右側的「執行」面板中，點擊 **「匯入工作...」**。
3.  **選擇檔案**：選擇本專案提供的 `limit_time.xml` 檔案。
4.  **確認權限**：在彈出的視窗中，確認「一般」分頁下已勾選 **「以最高權限執行」**。

#### 修正路徑 (至關重要)：
匯入後，請務必根據你的實際存放位置修改路徑，否則程式將無法啟動：
1.  在工作排程器中找到剛匯入的任務（名稱通常為 `limit_time`），按右鍵選擇 **「內容」**。
2.  切換至 **「操作」** (Actions) 分頁，選取「啟動程式」後點擊 **「編輯」**。
3.  **程式或指令碼**：修改為你 `.exe` 檔案的實際路徑（例如：`D:\dist\limit_time.exe`）。
4.  **起始於 (選填)**：**務必**填入該程式所在的資料夾路徑（例如：`D:\dist`），這能確保程式正確讀取到同目錄下的 `limit_time.ini`。

#### 運作機制說明：
* **啟動觸發**：系統設定為電腦開機後自動執行。
* **延遲啟動**：預設設定延遲 30 秒啟動，以避開開機時的系統壅塞，確保網路環境已就緒。
* **持續執行**：任務設定為不論使用者是否登入皆可執行，且若執行失敗會嘗試重新啟動。

> **提示**：匯入完成後，你可以對該任務按右鍵選擇「執行」，測試程式是否能正常啟動（檢查 `limit_time.log` 是否有新的紀錄）。
